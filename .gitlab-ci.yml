image: gumjoe/wacc-ci-scala:slim

stages:         
  - build
  - test

variables:
  GIT_SUBMODULE_STRATEGY: recursive

build-job:       
  stage: build
  script:
    - echo "Building..."
    - ./init.sh
    - echo "Build complete."

unit-test-job:  
  stage: test   
  script:
    - echo "Running unit tests..."
    - scala-cli test . --test-only 'wacc.unit*'
    - echo "Unit tests complete."

integration-test-job:  
  stage: test   
  script:
    - git submodule update --init --recursive || true
    - echo "Running integration tests..."
    - scala-cli test . --test-only 'wacc.integration*'
    - echo "Integation tests complete."

style-test-job:
  stage: test
  script: 
    - echo "Performing style check..."
    - scala-cli compile . --test --server=false
    - scalafix --check src --scalac-options "-Xlint:unused" --auto-classpath --stdout || true
    - echo "Style check complete."
